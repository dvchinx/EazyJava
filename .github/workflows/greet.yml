name: Greet New Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

jobs:
  greeting:
    runs-on: ubuntu-latest
    steps:
    - name: Saludar nuevo contributor en Issues
      if: github.event_name == 'issues'
      uses: actions/github-script@v6
      with:
        script: |
          const issue = context.payload.issue;
          const isFirstIssue = await github.rest.search.issuesAndPullRequests({
            q: `author:${issue.user.login} type:issue repo:${context.repo.owner}/${context.repo.repo}`
          });
          
          if (isFirstIssue.data.total_count === 1) {
            await github.rest.issues.createComment({
              issue_number: issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `¡Hola @${issue.user.login}! 👋

              ¡Gracias por abrir tu primer issue en PyJava! 🎉

              Tu contribución es muy valiosa para la comunidad. Un mantenedor revisará tu issue pronto.

              Mientras tanto, si tienes alguna pregunta, no dudes en:
              - Revisar nuestro [CONTRIBUTING.md](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/CONTRIBUTING.md)
              - Unirte a las [Discusiones](https://github.com/${context.repo.owner}/${context.repo.repo}/discussions)

              ¡Gracias por contribuir a PyJava! 🚀`
            });
          }

    - name: Saludar nuevo contributor en PRs
      if: github.event_name == 'pull_request_target'
      uses: actions/github-script@v6
      with:
        script: |
          const pr = context.payload.pull_request;
          const isFirstPR = await github.rest.search.issuesAndPullRequests({
            q: `author:${pr.user.login} type:pr repo:${context.repo.owner}/${context.repo.repo}`
          });
          
          if (isFirstPR.data.total_count === 1) {
            await github.rest.issues.createComment({
              issue_number: pr.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `¡Hola @${pr.user.login}! 👋

              ¡Gracias por tu primer Pull Request en PyJava! 🎉

              Tu contribución es muy apreciada. Aquí tienes algunos puntos importantes:

              - ✅ Asegúrate de que todos los tests pasen
              - 📝 Verifica que has seguido nuestras [guías de contribución](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/CONTRIBUTING.md)
              - 🔍 Un mantenedor revisará tu PR pronto

              Si necesitas ayuda, no dudes en preguntar en los comentarios.

              ¡Gracias por contribuir a PyJava! 🚀`
            });
          }